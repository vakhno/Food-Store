"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");require("prop-types");var t,n,a,o,r,i=require("@reach/utils"),u=require("@reach/descendants"),l=require("highlight-words-core"),s=require("@reach/auto-id"),c=require("@reach/popover");function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function d(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t.indexOf(n=r[a])>=0||(o[n]=e[n]);return o}var f="IDLE",E="SUGGESTING",p="NAVIGATING",C="INTERACTING",b={initial:f,states:(r={},r.IDLE={on:(t={},t.BLUR=f,t.CLEAR=f,t.CHANGE=E,t.INITIAL_CHANGE=f,t.FOCUS=E,t.NAVIGATE=p,t.OPEN_WITH_BUTTON=E,t)},r[E]={on:(n={},n.CHANGE=E,n.FOCUS=E,n.NAVIGATE=p,n.CLEAR=f,n.ESCAPE=f,n.BLUR=f,n.SELECT_WITH_CLICK=f,n.INTERACT=C,n.CLOSE_WITH_BUTTON=f,n)},r[p]={on:(a={},a.CHANGE=E,a.FOCUS=E,a.CLEAR=f,a.BLUR=f,a.ESCAPE=f,a.NAVIGATE=p,a.SELECT_WITH_CLICK=f,a.SELECT_WITH_KEYBOARD=f,a.CLOSE_WITH_BUTTON=f,a.INTERACT=C,a)},r[C]={on:(o={},o.CLEAR=f,o.CHANGE=E,o.FOCUS=E,o.BLUR=f,o.ESCAPE=f,o.NAVIGATE=p,o.CLOSE_WITH_BUTTON=f,o.SELECT_WITH_CLICK=f,o)},r)},x=function(e,t){var n=v({},e,{lastEventType:t.type});switch(t.type){case"CHANGE":case"INITIAL_CHANGE":return v({},n,{navigationValue:null,value:t.value});case"NAVIGATE":case"OPEN_WITH_BUTTON":return v({},n,{navigationValue:I(n,t)});case"CLEAR":return v({},n,{value:"",navigationValue:null});case"BLUR":case"ESCAPE":return v({},n,{navigationValue:null});case"SELECT_WITH_CLICK":return v({},n,{value:t.value,navigationValue:null});case"SELECT_WITH_KEYBOARD":return v({},n,{value:e.navigationValue,navigationValue:null});case"CLOSE_WITH_BUTTON":return v({},n,{navigationValue:null});case"INTERACT":return n;case"FOCUS":return v({},n,{navigationValue:I(n,t)});default:return n}};function T(e){return[E,p,C].includes(e)}function I(e,t){return t.value?t.value:t.persistSelection?e.value:null}var A=u.createDescendantContext("ComboboxDescendantContext"),h=i.createNamedContext("ComboboxContext",{}),g=i.createNamedContext("OptionContext",{}),m=i.forwardRefWithAs((function(t,n){var a,o=t.onSelect,r=t.openOnFocus,l=void 0!==r&&r,c=t.children,f=t.as,E=void 0===f?"div":f,p=t["aria-label"],C=t["aria-labelledby"],I=d(t,["onSelect","openOnFocus","children","as","aria-label","aria-labelledby"]),g=u.useDescendantsInit(),m=g[0],R=g[1],O=e.useRef(),N=e.useRef(),L=e.useRef(),S=e.useRef(),_=e.useRef(),w=function(t,n,a){var o=e.useState(t.initial),r=o[0],i=o[1],u=e.useReducer(n,{value:"",navigationValue:null}),l=u[1];return[r,u[0],function(e,n){void 0===n&&(n={});var a=t.states[r],o=a&&a.on[e];if(o)return l(v({type:e,state:r,nextState:r},n)),void i(o)}]}(b,x),y=w[0],V=w[1],G=w[2];!function(e,t){i.useIsomorphicLayoutEffect((function(){"NAVIGATE"!==e&&"ESCAPE"!==e&&"SELECT_WITH_CLICK"!==e&&"OPEN_WITH_BUTTON"!==e||t.current.focus()}),[t,e])}(V.lastEventType,O);var D=s.useId(I.id),W=D?i.makeId("listbox",D):"listbox",k={ariaLabel:p,ariaLabelledby:C,autocompletePropRef:S,buttonRef:L,comboboxId:D,data:V,inputRef:O,isExpanded:T(y),listboxId:W,onSelect:o||i.noop,openOnFocus:l,persistSelectionRef:_,popoverRef:N,state:y,transition:G};return i.useCheckStyles("combobox"),e.createElement(u.DescendantProvider,{context:A,items:m,set:R},e.createElement(h.Provider,{value:k},e.createElement(E,Object.assign({},I,{"data-reach-combobox":"","data-state":H(y),ref:n}),i.isFunction(c)?c({id:D,isExpanded:T(y),navigationValue:null!==(a=V.navigationValue)&&void 0!==a?a:null,state:y}):c)))})),R=i.forwardRefWithAs((function(t,n){var a=t.as,o=void 0===a?"input":a,r=t.selectOnClick,u=void 0!==r&&r,l=t.autocomplete,s=void 0===l||l,c=t.onClick,v=t.onChange,f=t.onKeyDown,E=t.onBlur,b=t.onFocus,x=t.value,T=d(t,["as","selectOnClick","autocomplete","onClick","onChange","onKeyDown","onBlur","onFocus","value"]),I=e.useRef(x).current,A=e.useRef(!1);i.useUpdateEffect((function(){A.current=!0}),[x]);var g=e.useContext(h),m=g.data,R=m.navigationValue,O=m.value,N=m.lastEventType,L=g.inputRef,S=g.state,_=g.transition,G=g.listboxId,D=g.autocompletePropRef,W=g.openOnFocus,k=g.isExpanded,B=g.ariaLabel,U=g.ariaLabelledby,F=i.useForkedRef(L,n),P=e.useRef(!1),K=w(),j=y(),q=null!=x;i.useIsomorphicLayoutEffect((function(){D.current=s}),[s,D]);var M=e.useCallback((function(e){""===e.trim()?_("CLEAR"):_(e!==I||A.current?"CHANGE":"INITIAL_CHANGE",{value:e})}),[I,_]);e.useEffect((function(){!q||x===O||""===x.trim()&&""===(O||"").trim()||M(x)}),[x,M,q,O]);var Y=!s||S!==p&&S!==C?x||O:R||x||O;return e.createElement(o,Object.assign({"aria-activedescendant":R?String(V(R)):void 0,"aria-autocomplete":"both","aria-controls":G,"aria-expanded":k,"aria-haspopup":"listbox","aria-label":B,"aria-labelledby":B?void 0:U,role:"combobox"},T,{"data-reach-combobox-input":"","data-state":H(S),ref:F,onBlur:i.wrapEvent(E,j),onChange:i.wrapEvent(v,(function(e){q||M(e.target.value)})),onClick:i.wrapEvent(c,(function(){P.current&&(P.current=!1,L.current.select())})),onFocus:i.wrapEvent(b,(function(){u&&(P.current=!0),W&&"SELECT_WITH_CLICK"!==N&&_("FOCUS")})),onKeyDown:i.wrapEvent(f,K),value:Y||""}))})),O=i.forwardRefWithAs((function(t,n){var a=t.as,o=void 0===a?"div":a,r=t.children,u=t.portal,l=void 0===u||u,s=t.onKeyDown,v=t.onBlur,f=t.position,E=void 0===f?c.positionMatchWidth:f,p=d(t,["as","children","portal","onKeyDown","onBlur","position"]),C=e.useContext(h),b=C.inputRef,x=C.isExpanded,T=C.state,I=i.useForkedRef(C.popoverRef,n),A=w(),g=y(),m={"data-reach-combobox-popover":"","data-state":H(T),onKeyDown:i.wrapEvent(s,A),onBlur:i.wrapEvent(v,g),hidden:!x,tabIndex:-1,children:r};return l?e.createElement(c.Popover,Object.assign({as:o},p,{ref:I,position:E,targetRef:b},m)):e.createElement(o,Object.assign({ref:I},p,m))})),N=i.forwardRefWithAs((function(t,n){var a=t.persistSelection,o=void 0!==a&&a,r=t.as,i=void 0===r?"ul":r,u=d(t,["persistSelection","as"]),l=e.useContext(h),s=l.listboxId;return o&&(l.persistSelectionRef.current=!0),e.createElement(i,Object.assign({role:"listbox"},u,{ref:n,"data-reach-combobox-list":"",id:s}))})),L=i.forwardRefWithAs((function(t,n){var a=t.as,o=void 0===a?"li":a,r=t.children,l=t.value,s=t.onClick,c=d(t,["as","children","value","onClick"]),v=e.useContext(h),f=v.onSelect,E=v.data.navigationValue,p=v.transition,C=e.useRef(null),b=i.useForkedRef(n,C),x=u.useDescendant({element:C.current,value:l},A),T=E===l;return e.createElement(g.Provider,{value:{value:l,index:x}},e.createElement(o,Object.assign({"aria-selected":T,role:"option"},c,{"data-reach-combobox-option":"",ref:b,id:String(V(l)),"data-highlighted":T?"":void 0,tabIndex:-1,onClick:i.wrapEvent(s,(function(){f&&f(l),p("SELECT_WITH_CLICK",{value:l})}))}),r?i.isFunction(r)?r({value:l,index:x}):r:e.createElement(S,null)))}));function S(){var t=e.useContext(g).value,n=e.useContext(h).data.value,a=e.useMemo((function(){return l.findAll({searchWords:G(n||"").split(/\s+/),textToHighlight:t})}),[n,t]);return e.createElement(e.Fragment,null,a.length?a.map((function(n,a){var o=t.slice(n.start,n.end);return e.createElement("span",{key:a,"data-reach-combobox-option-text":"","data-user-value":!!n.highlight||void 0,"data-suggested-value":!n.highlight||void 0},o)})):t)}var _=i.forwardRefWithAs((function(t,n){var a=t.as,o=void 0===a?"button":a,r=t.onClick,u=t.onKeyDown,l=d(t,["as","onClick","onKeyDown"]),s=e.useContext(h),c=s.transition,v=s.state,E=s.listboxId,p=s.isExpanded,C=i.useForkedRef(s.buttonRef,n),b=w();return e.createElement(o,Object.assign({"aria-controls":E,"aria-haspopup":"listbox","aria-expanded":p},l,{"data-reach-combobox-button":"",ref:C,onClick:i.wrapEvent(r,(function(){c(v===f?"OPEN_WITH_BUTTON":"CLOSE_WITH_BUTTON")})),onKeyDown:i.wrapEvent(u,b)}))}));function w(){var t=e.useContext(h),n=t.data.navigationValue,a=t.onSelect,o=t.state,r=t.transition,i=t.autocompletePropRef,l=t.persistSelectionRef,s=u.useDescendants(A);return function(e){var t=s.findIndex((function(e){return e.value===n}));function u(){return s[0]}function c(){return s[s.length-1]}switch(e.key){case"ArrowDown":if(e.preventDefault(),!s||!s.length)return;if(o===f)r("NAVIGATE",{persistSelection:l.current});else{var v=t===s.length-1?i.current?null:u():s[(t+1)%s.length];r("NAVIGATE",{value:v?v.value:null})}break;case"ArrowUp":if(e.preventDefault(),!s||0===s.length)return;if(o===f)r("NAVIGATE");else{var d=0===t?i.current?null:c():-1===t?c():s[(t-1+s.length)%s.length];r("NAVIGATE",{value:d?d.value:null})}break;case"Home":case"PageUp":if(e.preventDefault(),!s||0===s.length)return;o===f?r("NAVIGATE"):r("NAVIGATE",{value:u().value});break;case"End":case"PageDown":if(e.preventDefault(),!s||0===s.length)return;o===f?r("NAVIGATE"):r("NAVIGATE",{value:c().value});break;case"Escape":o!==f&&r("ESCAPE");break;case"Enter":o===p&&null!==n&&(e.preventDefault(),a&&a(n),r("SELECT_WITH_KEYBOARD"))}}}function y(){var t=e.useContext(h),n=t.state,a=t.transition,o=t.popoverRef,r=t.inputRef,u=t.buttonRef,l=i.useLazyRef((function(){return new Set}));return e.useEffect((function(){return function(){l.current.forEach((function(e){return cancelAnimationFrame(e)}))}}),[l]),function(){var e=i.getOwnerDocument(o.current);if(e){var t=requestAnimationFrame((function(){e.activeElement!==r.current&&e.activeElement!==u.current&&o.current&&(o.current.contains(e.activeElement)?n!==C&&a("INTERACT"):a("BLUR"))}));l.current.add(t)}}}function V(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}function H(e){return e.toLowerCase()}function G(e){return String(e).replace(/([.*+?=^!:${}()|[\]/\\])/g,"\\$1")}exports.Combobox=m,exports.ComboboxButton=_,exports.ComboboxInput=R,exports.ComboboxList=N,exports.ComboboxOption=L,exports.ComboboxOptionText=S,exports.ComboboxPopover=O,exports.escapeRegexp=G,exports.useComboboxContext=function(){var t=e.useContext(h),n=t.isExpanded,a=t.comboboxId,o=t.state,r=t.data.navigationValue;return e.useMemo((function(){return{id:a,isExpanded:n,navigationValue:null!=r?r:null,state:o}}),[a,n,r,o])},exports.useComboboxOptionContext=function(){var t=e.useContext(g),n=t.value,a=t.index;return e.useMemo((function(){return{value:n,index:a}}),[n,a])};
//# sourceMappingURL=combobox.cjs.production.min.js.map
