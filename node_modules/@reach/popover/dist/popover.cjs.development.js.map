{"version":3,"file":"popover.cjs.development.js","sources":["../src/index.tsx"],"sourcesContent":["/**\n * Welcome to @reach/popover!\n */\n\nimport * as React from \"react\";\nimport { Portal } from \"@reach/portal\";\nimport { useRect, PRect } from \"@reach/rect\";\nimport { forwardRefWithAs, getOwnerDocument, useForkedRef } from \"@reach/utils\";\nimport tabbable from \"tabbable\";\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Popover\n */\nconst Popover = forwardRefWithAs<PopoverProps, \"div\">(function Popover(\n  props,\n  ref\n) {\n  return (\n    <Portal>\n      <PopoverImpl ref={ref} {...props} />\n    </Portal>\n  );\n});\n\ntype PopoverProps = {\n  children: React.ReactNode;\n  targetRef: React.RefObject<HTMLElement>;\n  position?: Position;\n  /**\n   * Render the popover markup, but hide it â€“ used by MenuButton so that it\n   * can have an `aria-controls` attribute even when its menu isn't open, and\n   * used inside `Popover` as a hint that we can tell `useRect` to stop\n   * observing for better performance.\n   */\n  hidden?: boolean;\n  /**\n   * Testing this API so we might accept additional nodes that apps can use to\n   * determine the position of the popover. One example where it may be useful\n   * is for positioning the popover of a listbox where the cursor rests on top\n   * of the selected option. Pretty sure this will change so don't use it\n   * anywhere in public yet!\n   */\n  unstable_observableRefs?: React.RefObject<PossibleNode>[];\n};\n\nif (__DEV__) {\n  Popover.displayName = \"Popover\";\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * PopoverImpl\n *\n * Popover is conditionally rendered so we can't start measuring until it shows\n * up, so useRect needs to live down here not up in Popover\n */\nconst PopoverImpl = forwardRefWithAs<PopoverProps, \"div\">(function PopoverImpl(\n  {\n    as: Comp = \"div\",\n    targetRef,\n    position = positionDefault,\n    unstable_observableRefs = [],\n    ...props\n  },\n  forwardedRef\n) {\n  const popoverRef = React.useRef<HTMLDivElement>(null);\n  const popoverRect = useRect(popoverRef, { observe: !props.hidden });\n  const targetRect = useRect(targetRef, { observe: !props.hidden });\n  const ref = useForkedRef(popoverRef, forwardedRef);\n\n  useSimulateTabNavigationForReactTree(targetRef, popoverRef);\n\n  return (\n    <Comp\n      data-reach-popover=\"\"\n      ref={ref}\n      {...props}\n      style={{\n        position: \"absolute\",\n        ...getStyles(\n          position,\n          targetRect,\n          popoverRect,\n          ...unstable_observableRefs\n        ),\n        ...props.style,\n      }}\n    />\n  );\n});\n\nif (__DEV__) {\n  PopoverImpl.displayName = \"PopoverImpl\";\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\nfunction getStyles(\n  position: Position,\n  targetRect: PRect | null,\n  popoverRect: PRect | null,\n  ...unstable_observableRefs: React.RefObject<PossibleNode>[]\n): React.CSSProperties {\n  return popoverRect\n    ? position(\n        targetRect,\n        popoverRect,\n        ...unstable_observableRefs.map((ref) => ref.current)\n      )\n    : { visibility: \"hidden\" };\n}\n\nfunction getTopPosition(targetRect: PRect, popoverRect: PRect) {\n  const { directionUp } = getCollisions(targetRect, popoverRect);\n  return {\n    top: directionUp\n      ? `${targetRect.top - popoverRect.height + window.pageYOffset}px`\n      : `${targetRect.top + targetRect.height + window.pageYOffset}px`,\n  };\n}\n\nconst positionDefault: Position = (targetRect, popoverRect) => {\n  if (!targetRect || !popoverRect) {\n    return {};\n  }\n\n  const { directionRight } = getCollisions(targetRect, popoverRect);\n  return {\n    left: directionRight\n      ? `${targetRect.right - popoverRect.width + window.pageXOffset}px`\n      : `${targetRect.left + window.pageXOffset}px`,\n    ...getTopPosition(targetRect, popoverRect),\n  };\n};\n\nconst positionRight: Position = (targetRect, popoverRect) => {\n  if (!targetRect || !popoverRect) {\n    return {};\n  }\n\n  const { directionLeft } = getCollisions(targetRect, popoverRect);\n  return {\n    left: directionLeft\n      ? `${targetRect.left + window.pageXOffset}px`\n      : `${targetRect.right - popoverRect.width + window.pageXOffset}px`,\n    ...getTopPosition(targetRect, popoverRect),\n  };\n};\n\nconst positionMatchWidth: Position = (targetRect, popoverRect) => {\n  if (!targetRect || !popoverRect) {\n    return {};\n  }\n\n  return {\n    width: targetRect.width,\n    left: targetRect.left,\n    ...getTopPosition(targetRect, popoverRect),\n  };\n};\n\nfunction getCollisions(\n  targetRect: PRect,\n  popoverRect: PRect,\n  offsetLeft: number = 0,\n  offsetBottom: number = 0\n) {\n  const collisions = {\n    top: targetRect.top - popoverRect.height < 0,\n    right: window.innerWidth < targetRect.left + popoverRect.width - offsetLeft,\n    bottom:\n      window.innerHeight <\n      targetRect.bottom + popoverRect.height - offsetBottom,\n    left: targetRect.left + targetRect.width - popoverRect.width < 0,\n  };\n\n  const directionRight = collisions.right && !collisions.left;\n  const directionLeft = collisions.left && !collisions.right;\n  const directionUp = collisions.bottom && !collisions.top;\n  const directionDown = collisions.top && !collisions.bottom;\n\n  return { directionRight, directionLeft, directionUp, directionDown };\n}\n\n// Heads up, my jQuery past haunts this function. This hook scopes the tab\n// order to the React element tree, instead of the DOM tree. This way, when the\n// user navigates with tab from the targetRef, the tab order moves into the\n// popup, and then out of the popup back to the rest of the document.\n// (We call targetRef, triggerRef inside this function to avoid confusion with\n// event.target)\nfunction useSimulateTabNavigationForReactTree<\n  T extends HTMLElement,\n  P extends HTMLElement\n>(triggerRef: React.RefObject<T>, popoverRef: React.RefObject<P>) {\n  const ownerDocument = getOwnerDocument(triggerRef.current)!;\n\n  function handleKeyDown(event: KeyboardEvent) {\n    if (\n      event.key === \"Tab\" &&\n      popoverRef.current &&\n      tabbable(popoverRef.current).length === 0\n    ) {\n      return;\n    }\n\n    if (event.key === \"Tab\" && event.shiftKey) {\n      if (shiftTabbedFromElementAfterTrigger(event)) {\n        focusLastTabbableInPopover(event);\n      } else if (shiftTabbedOutOfPopover(event)) {\n        focusTriggerRef(event);\n      } else if (shiftTabbedToBrowserChrome(event)) {\n        disableTabbablesInPopover();\n      }\n    } else if (event.key === \"Tab\") {\n      if (tabbedFromTriggerToPopover()) {\n        focusFirstPopoverTabbable(event);\n      } else if (tabbedOutOfPopover()) {\n        focusTabbableAfterTrigger(event);\n      } else if (tabbedToBrowserChrome(event)) {\n        disableTabbablesInPopover();\n      }\n    }\n  }\n\n  React.useEffect(() => {\n    ownerDocument.addEventListener(\"keydown\", handleKeyDown);\n    return () => {\n      ownerDocument.removeEventListener(\"keydown\", handleKeyDown);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  function getElementAfterTrigger() {\n    const elements = tabbable(ownerDocument);\n    const targetIndex =\n      elements && triggerRef.current\n        ? elements.indexOf(triggerRef.current)\n        : -1;\n    const elementAfterTrigger = elements && elements[targetIndex + 1];\n    return popoverRef.current &&\n      popoverRef.current.contains(elementAfterTrigger || null)\n      ? false\n      : elementAfterTrigger;\n  }\n\n  function tabbedFromTriggerToPopover() {\n    return triggerRef.current\n      ? triggerRef.current === ownerDocument.activeElement\n      : false;\n  }\n\n  function focusFirstPopoverTabbable(event: KeyboardEvent) {\n    const elements = popoverRef.current && tabbable(popoverRef.current);\n    if (elements && elements[0]) {\n      event.preventDefault();\n      elements[0].focus();\n    }\n  }\n\n  function tabbedOutOfPopover() {\n    const inPopover = popoverRef.current\n      ? popoverRef.current.contains(ownerDocument.activeElement || null)\n      : false;\n    if (inPopover) {\n      const elements = popoverRef.current && tabbable(popoverRef.current);\n      return Boolean(\n        elements &&\n          elements[elements.length - 1] === ownerDocument.activeElement\n      );\n    }\n    return false;\n  }\n\n  function focusTabbableAfterTrigger(event: KeyboardEvent) {\n    const elementAfterTrigger = getElementAfterTrigger();\n    if (elementAfterTrigger) {\n      event.preventDefault();\n      elementAfterTrigger.focus();\n    }\n  }\n\n  function shiftTabbedFromElementAfterTrigger(event: KeyboardEvent) {\n    if (!event.shiftKey) return;\n    const elementAfterTrigger = getElementAfterTrigger();\n    return event.target === elementAfterTrigger;\n  }\n\n  function focusLastTabbableInPopover(event: KeyboardEvent) {\n    const elements = popoverRef.current && tabbable(popoverRef.current);\n    const last = elements && elements[elements.length - 1];\n    if (last) {\n      event.preventDefault();\n      last.focus();\n    }\n  }\n\n  function shiftTabbedOutOfPopover(event: KeyboardEvent) {\n    const elements = popoverRef.current && tabbable(popoverRef.current);\n    if (elements) {\n      return elements.length === 0 ? false : event.target === elements[0];\n    }\n    return false;\n  }\n\n  function focusTriggerRef(event: KeyboardEvent) {\n    event.preventDefault();\n    triggerRef.current?.focus();\n  }\n\n  function tabbedToBrowserChrome(event: KeyboardEvent) {\n    const elements = popoverRef.current\n      ? tabbable(ownerDocument).filter(\n          (element) => !popoverRef.current!.contains(element)\n        )\n      : null;\n    return elements ? event.target === elements[elements.length - 1] : false;\n  }\n\n  function shiftTabbedToBrowserChrome(event: KeyboardEvent) {\n    // we're assuming the popover will never contain the first tabbable\n    // element, and it better not, because the trigger needs to be tabbable!\n    return event.target === tabbable(ownerDocument)[0];\n  }\n\n  let restoreTabIndexTuplÃ©s: [HTMLElement, number][] = [];\n\n  function disableTabbablesInPopover() {\n    const elements = popoverRef.current && tabbable(popoverRef.current);\n    if (elements) {\n      elements.forEach((element) => {\n        restoreTabIndexTuplÃ©s.push([element, element.tabIndex]);\n        element.tabIndex = -1;\n      });\n      ownerDocument.addEventListener(\"focusin\", enableTabbablesInPopover);\n    }\n  }\n\n  function enableTabbablesInPopover() {\n    ownerDocument.removeEventListener(\"focusin\", enableTabbablesInPopover);\n    restoreTabIndexTuplÃ©s.forEach(([element, tabIndex]) => {\n      element.tabIndex = tabIndex;\n    });\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Types\n\ntype Position = (\n  targetRect?: PRect | null,\n  popoverRect?: PRect | null,\n  ...unstable_observableNodes: PossibleNode[]\n) => React.CSSProperties;\n\ntype PossibleNode = null | undefined | HTMLElement | SVGElement;\n\n////////////////////////////////////////////////////////////////////////////////\n// Exports\n\nexport default Popover;\nexport type { PopoverProps, Position };\nexport {\n  getCollisions,\n  Popover,\n  positionDefault,\n  positionMatchWidth,\n  positionRight,\n};\n"],"names":["Popover","forwardRefWithAs","props","ref","React","Portal","PopoverImpl","displayName","forwardedRef","as","Comp","targetRef","position","positionDefault","unstable_observableRefs","popoverRef","popoverRect","useRect","observe","hidden","targetRect","useForkedRef","useSimulateTabNavigationForReactTree","style","getStyles","map","current","visibility","getTopPosition","getCollisions","directionUp","top","height","window","pageYOffset","directionRight","left","right","width","pageXOffset","positionRight","directionLeft","positionMatchWidth","offsetLeft","offsetBottom","collisions","innerWidth","bottom","innerHeight","directionDown","triggerRef","ownerDocument","getOwnerDocument","handleKeyDown","event","key","tabbable","length","shiftKey","shiftTabbedFromElementAfterTrigger","focusLastTabbableInPopover","shiftTabbedOutOfPopover","focusTriggerRef","shiftTabbedToBrowserChrome","disableTabbablesInPopover","tabbedFromTriggerToPopover","focusFirstPopoverTabbable","tabbedOutOfPopover","focusTabbableAfterTrigger","tabbedToBrowserChrome","addEventListener","removeEventListener","getElementAfterTrigger","elements","targetIndex","indexOf","elementAfterTrigger","contains","activeElement","preventDefault","focus","inPopover","Boolean","target","last","filter","element","restoreTabIndexTuplÃ©s","forEach","push","tabIndex","enableTabbablesInPopover"],"mappings":"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"}